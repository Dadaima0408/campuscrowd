<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>ğŸ“ ä¸­å¤®å¤§å­¦ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒ—</h2>

  <%= link_to "ğŸ“Š æ··é›‘çŠ¶æ³ ä¸€è¦§ã‚’è¦‹ã‚‹", crowd_reports_path, class: "btn btn-outline-secondary" %>
</div>

<!-- ğŸ” ì•„ì´ì½˜ í•„í„° ë“œë¡­ë‹¤ìš´ -->
<label for="icon-filter">ã‚¢ã‚¤ã‚³ãƒ³ã§çµã‚Šè¾¼ã¿:</label>
<select id="icon-filter" class="form-select mb-3" style="width: 200px;">
  <option value="all">ã™ã¹ã¦è¡¨ç¤º</option>
  <% @locations.map(&:icon).uniq.compact.each do |icon| %>
    <option value="<%= icon %>"><%= icon %></option>
  <% end %>
</select>

<div id="map-container" style="position: relative; width: 100%; max-width: 1200px;">
  <%= image_tag "ChuTamamap.png", id: "campus-map", alt: "ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒ—", style: "width: 100%;" %>

  <% @locations.each do |location| %>
    <% if location.x.present? && location.y.present? %>
      <div class="map-pin"
           data-icon="<%= location.icon %>"
           data-x="<%= location.x %>"
           data-y="<%= location.y %>">
        <%= link_to (location.icon.presence || "ğŸ“"), location_path(location), style: "font-size: 24px;" %>
      </div>
    <% end %>
  <% end %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const map = document.getElementById("campus-map");
    const pins = document.querySelectorAll(".map-pin");

    const adjustPins = () => {
      const scaleX = map.width / map.naturalWidth;
      const scaleY = map.height / map.naturalHeight;

      pins.forEach(pin => {
        const x = parseInt(pin.dataset.x);
        const y = parseInt(pin.dataset.y);
        pin.style.position = "absolute";
        pin.style.left = `${x * scaleX}px`;
        pin.style.top = `${y * scaleY}px`;
      });
    };

    adjustPins();
    window.addEventListener("resize", adjustPins); // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì¬ê³„ì‚°
  });
</script>

<hr>

<h3>ğŸ“‹ ç™»éŒ²æ¸ˆã¿ã®å ´æ‰€</h3>
<ul>
  <% @locations.each do |location| %>
    <li>
      <%= link_to (location.icon.presence || "ğŸ“") + " " + location.name, location_path(location) %>
      ï¼ˆ<%= location.category %>ï¼‰
    </li>
  <% end %>
</ul>

<%= link_to "â• æ–°ã—ã„å ´æ‰€ã‚’ç™»éŒ²", new_location_path, class: "btn btn-primary mt-3" %>