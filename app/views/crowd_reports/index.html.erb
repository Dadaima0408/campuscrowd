<div class="container mt-5">
  <h2 class="mb-4">混雑状況 一覧</h2>
<div class="mb-3">
  <label for="level-filter" class="form-label">混雑レベルで絞り込み:</label>
  <select id="level-filter" class="form-select" style="width: 200px;">
    <option value="all">すべて表示</option>
    <% (1..5).each do |level| %>
      <option value="<%= level %>">Level <%= level %></option>
    <% end %>
  </select>

<div class="mb-3">
  <%= link_to "📍 キャンパスマップを見る", locations_path, class: "btn btn-outline-primary" %>
</div>


<div class="alert alert-info">
  <h5>🗂️ 混雑レベルの説明:</h5>
  <ul class="mb-0">
    <li>Level 1：とても空いています</li>
    <li>Level 2：少し空いています</li>
    <li>Level 3：普通です</li>
    <li>Level 4：やや混んでいます</li>
    <li>Level 5：非常に混んでいます</li>
  </ul>
</div>
  
<div class="row">
  <% @crowd_reports.each do |report| %>
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm p-3" data-level="<%= report.level %>">
        <h5>📊 レベル: <%= report.level.presence || "未設定" %></h5>
        <p>🕒 時間帯: <%= report.time_slot.presence || "（未指定）" %></p>
        <p>📝 コメント: <%= report.comment.presence || "（コメントなし）" %></p>
        <p>📍 場所: <%= report.location&.name || "（不明な場所）" %></p>

        <% if report.is_recurring %>
          <p>🔁 定期的: はい</p>
          <p>📅 繰り返し: <%= report.recurrence_pattern %></p>
          <p>⏳ 終了日: <%= report.recurrence_end&.strftime("%Y年%m月%d日") %></p>
        <% else %>
          <p>🔁 定期的: いいえ</p>
        <% end %>

        <div class="mt-3 d-flex justify-content-between">
          <%= link_to "🔍 詳細を見る", crowd_report_path(report), class: "btn btn-outline-primary btn-sm" %>
          <%= link_to "✏️ 編集", edit_crowd_report_path(report), class: "btn btn-outline-secondary btn-sm" %>
          <%= link_to "🗑️ 削除", report, method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-outline-danger btn-sm" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

  <div class="mt-4">
    <%= link_to "➕ 新しい投稿", new_crowd_report_path, class: "btn btn-success" %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const filter = document.getElementById("level-filter");
    const reports = document.querySelectorAll("[data-level]");

    filter.addEventListener("change", () => {
      const value = filter.value;
      reports.forEach(report => {
        if (value === "all" || report.dataset.level === value) {
          report.style.display = "";
        } else {
          report.style.display = "none";
        }
      });
    });
  });
</script>